<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Klay-Clam"><title>Node接收和处理前端的Ajax请求 · 拖泥脑湿的博客</title><meta name="description" content="前几天在学习 express 的过程中，不想使用一些类似ejs这样的模板中的一些特性，所以尝试着使用ajax来与node后端交互。来这里记录一下。

1. 安装express
当然安装和使用express的前提是，你的设备已经有Node的环境了。没有的话自己去找吧～嘻嘻。    我的环境：Ubunt"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">Tony's Notebook</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">拖泥脑湿的手账</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/categories">分类</a></li><li><a href="/tags">标签</a></li><li class="soc"><a href="https://github.com/Klay-Clam" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2019&nbsp;<a target="_blank" href="http://yoursite.com" rel="noopener noreferrer">Klay-Clam</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>Node接收和处理前端的Ajax请求</a></p><p class="post-meta"><span class="date meta-item">发布于&nbsp;2017-08-02</span><span class="meta-item"><i class="fa fa-folder"></i><span>&nbsp;</span><a href="/categories/node/" title="node" class="a-tag">node</a><span>&nbsp;</span></span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/node/" title="node" class="a-tag">node</a><span>&nbsp;</span><a href="/tags/express/" title="express" class="a-tag">express</a><span>&nbsp;</span><a href="/tags/ajax/" title="ajax" class="a-tag">ajax</a><span>&nbsp;</span></span></p><p class="post-abstract"><blockquote>
<p>前几天在学习 <code>express</code> 的过程中，不想使用一些类似<code>ejs</code>这样的模板中的一些特性，所以尝试着使用ajax来与node后端交互。来这里记录一下。</p>
</blockquote>
<h3 id="1-安装express"><a href="#1-安装express" class="headerlink" title="1. 安装express"></a>1. 安装express</h3><blockquote>
<p>当然安装和使用express的前提是，你的设备已经有Node的环境了。没有的话自己去找吧～嘻嘻。<br>    我的环境：<code>Ubuntu 16.04、node v6.10.2、npm 3.10.10</code></p>
</blockquote>
<ul>
<li>使用<code>npm install -g express</code> ,全局安装express。使用命令<code>express --version</code>检查是否正确安装了，如果已经正确的安装，就会打印版本号。<blockquote>
<p>需要注意的是，使用npm的时候有可能会出现权限不足的问题，这时只需要使用 <code>sudo npm install express</code>即可。</p>
</blockquote>
</li>
</ul>
<h3 id="2-创建一个express项目"><a href="#2-创建一个express项目" class="headerlink" title="2. 创建一个express项目"></a>2. 创建一个express项目</h3><ul>
<li><p>命令行进入你想创建项目的路径，使用<code>express -e my-first-project</code>创建一个名为<strong>my-first-project</strong>的项目。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span> dependencies:</span><br><span class="line">     $ cd my-<span class="keyword">first</span>-<span class="keyword">project</span> &amp;&amp; npm <span class="keyword">install</span></span><br><span class="line"></span><br><span class="line">   run the app:</span><br><span class="line">     $ DEBUG=my-<span class="keyword">first</span>-<span class="keyword">project</span>:* npm <span class="keyword">start</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>提示我们进入项目目录，并安装依赖：<code>cd my-first-project &amp;&amp; npm install</code> ,npm 就会开始下载一些项目需要的依赖啦，比如<code>ejs</code></p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">my-first-project@<span class="number">0.0</span><span class="number">.0</span> /media/clam/Document/WebStormworkspace/Vue/my-first-project</span><br><span class="line">├─┬ body-parser@<span class="number">1.17</span><span class="number">.2</span> </span><br><span class="line">│ ├── bytes@<span class="number">2.4</span><span class="number">.0</span> </span><br><span class="line">│ ├── content-type@<span class="number">1.0</span><span class="number">.2</span> </span><br><span class="line">│ ├── debug@<span class="number">2.6</span><span class="number">.7</span> </span><br><span class="line">│ ├── depd@<span class="number">1.1</span><span class="number">.1</span> </span><br><span class="line">│ ├─┬ http-errors@<span class="number">1.6</span><span class="number">.1</span> </span><br><span class="line">│ │ ├── depd@<span class="number">1.1</span><span class="number">.0</span> </span><br><span class="line">│ │ └── inherits@<span class="number">2.0</span><span class="number">.3</span> </span><br><span class="line">│ ├── iconv-lite@<span class="number">0.4</span><span class="number">.15</span> </span><br><span class="line">│ ├─┬ on-finished@<span class="number">2.3</span><span class="number">.0</span> </span><br><span class="line">│ │ └── ee-first@<span class="number">1.1</span><span class="number">.1</span> </span><br><span class="line">│ ├── qs@<span class="number">6.4</span><span class="number">.0</span> </span><br><span class="line">│ ├─┬ raw-body@<span class="number">2.2</span><span class="number">.0</span> </span><br><span class="line">│ │ └── unpipe@<span class="number">1.0</span><span class="number">.0</span> </span><br><span class="line">│ └─┬ type-is@<span class="number">1.6</span><span class="number">.15</span> </span><br><span class="line">│   ├── media-typer@<span class="number">0.3</span><span class="number">.0</span> </span><br><span class="line">│   └─┬ mime-types@<span class="number">2.1</span><span class="number">.16</span> </span><br><span class="line">│     └── mime-db@<span class="number">1.29</span><span class="number">.0</span> </span><br><span class="line">├─┬ cookie-parser@<span class="number">1.4</span><span class="number">.3</span> </span><br><span class="line">│ ├── cookie@<span class="number">0.3</span><span class="number">.1</span> </span><br><span class="line">│ └── cookie-signature@<span class="number">1.0</span><span class="number">.6</span> </span><br><span class="line">├─┬ debug@<span class="number">2.6</span><span class="number">.8</span> </span><br><span class="line">│ └── ms@<span class="number">2.0</span><span class="number">.0</span> </span><br><span class="line">├── ejs@<span class="number">2.5</span><span class="number">.7</span> </span><br><span class="line">├─┬ express@<span class="number">4.15</span><span class="number">.3</span> </span><br><span class="line">│ ├─┬ accepts@<span class="number">1.3</span><span class="number">.3</span> </span><br><span class="line">│ │ └── negotiator@<span class="number">0.6</span><span class="number">.1</span> </span><br><span class="line">│ ├── array-flatten@<span class="number">1.1</span><span class="number">.1</span> </span><br><span class="line">│ ├── content-disposition@<span class="number">0.5</span><span class="number">.2</span> </span><br><span class="line">│ ├── debug@<span class="number">2.6</span><span class="number">.7</span> </span><br><span class="line">│ ├── encodeurl@<span class="number">1.0</span><span class="number">.1</span> </span><br><span class="line">│ ├── escape-html@<span class="number">1.0</span><span class="number">.3</span> </span><br><span class="line">│ ├── etag@<span class="number">1.8</span><span class="number">.0</span> </span><br><span class="line">│ ├─┬ finalhandler@<span class="number">1.0</span><span class="number">.3</span> </span><br><span class="line">│ │ └── debug@<span class="number">2.6</span><span class="number">.7</span> </span><br><span class="line">│ ├── fresh@<span class="number">0.5</span><span class="number">.0</span> </span><br><span class="line">│ ├── merge-descriptors@<span class="number">1.0</span><span class="number">.1</span> </span><br><span class="line">│ ├── methods@<span class="number">1.1</span><span class="number">.2</span> </span><br><span class="line">│ ├── parseurl@<span class="number">1.3</span><span class="number">.1</span> </span><br><span class="line">│ ├── path-to-regexp@<span class="number">0.1</span><span class="number">.7</span> </span><br><span class="line">│ ├─┬ proxy-addr@<span class="number">1.1</span><span class="number">.5</span> </span><br><span class="line">│ │ ├── forwarded@<span class="number">0.1</span><span class="number">.0</span> </span><br><span class="line">│ │ └── ipaddr.js@<span class="number">1.4</span><span class="number">.0</span> </span><br><span class="line">│ ├── range-parser@<span class="number">1.2</span><span class="number">.0</span> </span><br><span class="line">│ ├─┬ send@<span class="number">0.15</span><span class="number">.3</span> </span><br><span class="line">│ │ ├── debug@<span class="number">2.6</span><span class="number">.7</span> </span><br><span class="line">│ │ ├── destroy@<span class="number">1.0</span><span class="number">.4</span> </span><br><span class="line">│ │ └── mime@<span class="number">1.3</span><span class="number">.4</span> </span><br><span class="line">│ ├── serve-static@<span class="number">1.12</span><span class="number">.3</span> </span><br><span class="line">│ ├── setprototypeof@<span class="number">1.0</span><span class="number">.3</span> </span><br><span class="line">│ ├── statuses@<span class="number">1.3</span><span class="number">.1</span> </span><br><span class="line">│ ├── utils-merge@<span class="number">1.0</span><span class="number">.0</span> </span><br><span class="line">│ └── vary@<span class="number">1.1</span><span class="number">.1</span> </span><br><span class="line">├─┬ morgan@<span class="number">1.8</span><span class="number">.2</span> </span><br><span class="line">│ ├── basic-auth@<span class="number">1.1</span><span class="number">.0</span> </span><br><span class="line">│ └── on-headers@<span class="number">1.0</span><span class="number">.1</span> </span><br><span class="line">└─┬ serve-favicon@<span class="number">2.4</span><span class="number">.3</span> </span><br><span class="line">  └── safe-buffer@<span class="number">5.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>震惊！居然有这么多..</p>
<ul>
<li>接下来我们来看看项目的文件结构吧<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── app.js</span><br><span class="line">├── bin</span><br><span class="line">│   └── www</span><br><span class="line">├── node_modules</span><br><span class="line">│   └── 这里有一堆文件..</span><br><span class="line">│   </span><br><span class="line">├── package.json</span><br><span class="line">├── public</span><br><span class="line">│   ├── images</span><br><span class="line">│   ├── javascripts</span><br><span class="line">│   └── stylesheets</span><br><span class="line">│       └── style.css</span><br><span class="line">├── routes</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   └── users.js</span><br><span class="line">└── views</span><br><span class="line">    ├── error.ejs</span><br><span class="line">    └── index.ejs</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<ol>
<li><strong>bin</strong> 存放我们最终上线部署的文件;<br></li>
<li><strong>node_modules</strong> 存放我们项目中下载的依赖;<br></li>
<li><strong>package.json</strong> 我们项目的一些配置文件的设置，项目的信息等。<br></li>
<li><strong>public</strong> 存放一些静态文件，图片呀，字体呀，css呀，js呀什么的。<br></li>
<li><strong>routes</strong> 我们项目的路由就在这里编写，相当于controller。下面有两个示例路由文件。<br></li>
<li><strong>views</strong>  我们项目的视图就是放在这里的。下面有两个示例的试图文件，在这里你会发现是<code>.ejs</code>文件。这是因为我们在创建项目的时候使用了ejs模板引擎。等开始之后我们不会用他。<br></li>
<li><strong>app.js</strong> 这个文件，是我们项目的入口。 </li>
</ol>
<ul>
<li>让我们来启动项目看效果吧～<br>使用命令<code>node ./bin/www</code>或者<code>npm start</code>都可以启动项目。然后我们打开浏览器，输入 <strong><a href="http://127.0.0.1:3000" target="_blank" rel="noopener">http://127.0.0.1:3000</a></strong>,就可以看到效果了。<blockquote>
<p>Welcome to Express!</p>
</blockquote>
</li>
</ul>
<h3 id="3-进入正题"><a href="#3-进入正题" class="headerlink" title="3. 进入正题"></a>3. 进入正题</h3><blockquote>
<p>扯了那么多终于进入正题了。不过在此之前，我们首先要将.ejs文件改成.html,这样顺眼多了..</p>
</blockquote>
<ul>
<li>打开 app.js<br>找到 <code>// view engine setup</code>，在下面添加代码<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">app</span><span class="selector-class">.engine</span>(<span class="string">'.html'</span>, ejs.__express);</span><br><span class="line"><span class="selector-tag">app</span><span class="selector-class">.set</span>(<span class="string">'view engine'</span>, <span class="string">'html'</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在顶端引入ejs<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ejs = <span class="built_in">require</span>(<span class="string">'ejs'</span>);</span><br><span class="line">做完这些修改之后，记得将views文件夹下面的文件后缀全都修改成.html哈，当然虽然是.html文件，但是依旧可以使用ejs的特性。</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>做完这些修改之后，记得将views文件夹下面的文件后缀全都修改成.html哈，当然虽然是.html文件，但是依旧可以使用ejs的特性。</p>
</blockquote>
<ul>
<li>编写前端视图文件<br>就在 <code>index.html</code>文件的基础上修改好了。下面是我写的demo：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> <span class="attr">href</span>=<span class="string">'/stylesheets/style.css'</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/javascripts/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"searchKeyWord"</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"search"</span>&gt;</span>Search<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"title"</span>&gt;</span>Title:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">placeholder</span>=<span class="string">"TITLE"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"content"</span>&gt;</span>Content:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"content"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">placeholder</span>=<span class="string">"Content"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"submit"</span>&gt;</span>submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>写到这里，觉得还是给这个小项目创建一个数据库吧，这样写起来可能更有意思一点。</p>
</blockquote>
<ul>
<li>创建数据库<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 已经开启了用户认证，所以首先在命令行中先为数据库创建用户</span><br><span class="line">&gt;<span class="selector-tag">mongo</span></span><br><span class="line">&gt;<span class="selector-tag">use</span> <span class="selector-tag">blog</span> </span><br><span class="line">&gt;<span class="selector-tag">db</span><span class="selector-class">.createUser</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attribute">user</span>:<span class="string">'bloger'</span>,</span><br><span class="line">    <span class="attribute">pwd</span>:<span class="string">'bloger'</span>,</span><br><span class="line">    <span class="attribute">roles</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attribute">role</span>:<span class="string">'readWrite'</span>,</span><br><span class="line">        <span class="attribute">db</span>:<span class="string">'blog'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">#创建成功</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>进入项目目录，安装mongoose,打开 <code>package.json</code>，添加mmongoose依赖。<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"body-parser"</span>: <span class="string">"~1.17.1"</span>,</span><br><span class="line">    <span class="string">"cookie-parser"</span>: <span class="string">"~1.4.3"</span>,</span><br><span class="line">    <span class="string">"debug"</span>: <span class="string">"~2.6.3"</span>,</span><br><span class="line">    <span class="string">"ejs"</span>: <span class="string">"~2.5.6"</span>,</span><br><span class="line">    <span class="string">"express"</span>: <span class="string">"~4.15.2"</span>,</span><br><span class="line">    <span class="string">"morgan"</span>: <span class="string">"~1.8.1"</span>,</span><br><span class="line">    <span class="string">"serve-favicon"</span>: <span class="string">"~2.4.2"</span>,</span><br><span class="line">    <span class="string">"mongoose"</span>:<span class="string">"4.11.5"</span> <span class="comment">// 添加mongoose依赖</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta"># 保存之后，在命令行中重新安装依赖</span></span><br><span class="line">&gt; npm install</span><br></pre></td></tr></table></figure></p>
<p>创建结构如下目录：<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">│—— models</span><br><span class="line"><span class="string">|  └── dbs</span></span><br><span class="line">│     ├── contents.js</span><br><span class="line">└── db.js</span><br></pre></td></tr></table></figure></p>
<p>以下是 <em>db.js</em>的内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置存储路径</span></span><br><span class="line"><span class="keyword">var</span> DB_URL = <span class="string">'mongodb://bloger:bloger@127.0.0.1:27017/blog'</span>;</span><br><span class="line"><span class="comment">//连接数据库</span></span><br><span class="line">mongoose.connect(DB_URL);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接成功之后输出语句</span></span><br><span class="line">mongoose.connection.on(<span class="string">"connected"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Mongoose connect '</span> + DB_URL + <span class="string">' success'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库连接失败之后 输出错误信息</span></span><br><span class="line">mongoose.connection.on(<span class="string">'error'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Mongoose connect error: "</span> + err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 断开数据库连接之后 输出日志</span></span><br><span class="line">mongoose.connection.on(<span class="string">"disconnected"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Mongoose connect disconnected'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose;</span><br></pre></td></tr></table></figure></p>
<p>以下是<em>contents.js</em>的内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'../db'</span>);</span><br><span class="line"><span class="keyword">var</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> blogSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    title:<span class="built_in">String</span>,</span><br><span class="line">    author:<span class="built_in">String</span>,</span><br><span class="line">    content:<span class="built_in">String</span>,</span><br><span class="line">    date: <span class="built_in">Date</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'blog'</span>,blogSchema);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>以上就是在命令行建立数据库、为数据库创建用户以及服务端使用mongoose模块操作数据库的代码。接下来，来看看前端如何使用ajax发起post请求。</p>
</blockquote>
<ul>
<li><p>前端发起ajax请求</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用jquery 来写ajax。首先在head标签中引入jquery。才能在这里用的。 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- script --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      $(<span class="string">"#submit"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> url = <span class="string">"/"</span>; <span class="comment">/*后端暴露给前端的接口*/</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> data = &#123;</span></span><br><span class="line"><span class="javascript">            title: $(<span class="string">'#title'</span>).val(),</span></span><br><span class="line"><span class="javascript">            author: $(<span class="string">'#author'</span>).val(),</span></span><br><span class="line"><span class="javascript">            content: $(<span class="string">'#content'</span>).val()</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="javascript">          $.ajax(&#123;</span></span><br><span class="line"><span class="undefined">            url: url,</span></span><br><span class="line"><span class="undefined">            data: data,</span></span><br><span class="line"><span class="actionscript">            dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="actionscript">            method: <span class="string">'post'</span>,</span></span><br><span class="line"><span class="actionscript">            success: <span class="function"><span class="keyword">function</span> <span class="params">(result)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">console</span>.log(result);</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="actionscript">            error: <span class="function"><span class="keyword">function</span> <span class="params">(err)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">console</span>.log(<span class="string">"something error: "</span> + err);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>后端如何接收和处理ajax的post请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/index.js</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="comment">// 引入数据库模块</span></span><br><span class="line"><span class="keyword">var</span> blogSchema = <span class="built_in">require</span>(<span class="string">'../models/dbs/contents'</span>);</span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">'index.html'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// post 请求</span></span><br><span class="line">router.post(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// 接收和处理post请求</span></span><br><span class="line">  <span class="keyword">var</span> blogStatus = <span class="keyword">new</span> blogSchema(&#123;</span><br><span class="line">    title: req.body.title,</span><br><span class="line">    author:req.body.author,</span><br><span class="line">    content:req.body.content,</span><br><span class="line">    date: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;);</span><br><span class="line">  blogSchema.collection.insert(blogStatus,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"insert error: "</span>+ err);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"insert success: "</span>+result);</span><br><span class="line">      res.send(result);</span><br><span class="line">      <span class="comment">//res.location('/allblogs');</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
</li>
<li><p>好的，现在让我们来启动项目，看看效果。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先启动mongodb服务</span></span><br><span class="line">sudo systemctl <span class="built_in">start</span> mongod</span><br><span class="line"><span class="comment"># 输入密码</span></span><br><span class="line">node ./bin/www</span><br><span class="line">(node:<span class="number">5289</span>) DeprecationWarning: `<span class="built_in">open</span>()` is deprecated <span class="keyword">in</span> mongoose &gt;= <span class="number">4.11</span><span class="number">.0</span>, use `openUri</span><br><span class="line">()` instead, <span class="keyword">or</span> <span class="built_in">set</span> <span class="keyword">the</span> `useMongoClient` option <span class="keyword">if</span> <span class="keyword">using</span> `connect()` <span class="keyword">or</span> `createConnection(</span><br><span class="line">)`. See <span class="keyword">http</span>://mongoosejs.com/docs/connections.html<span class="comment">#use-mongo-client</span></span><br><span class="line">Db.prototype.authenticate method will no longer be available <span class="keyword">in</span> <span class="keyword">the</span> next major release <span class="number">3.</span>x</span><br><span class="line"> <span class="keyword">as</span> MongoDB <span class="number">3.6</span> will only allow auth against users <span class="keyword">in</span> <span class="keyword">the</span> admin db <span class="keyword">and</span> will no longer allo</span><br><span class="line">w multiple credentials <span class="keyword">on</span> <span class="title">a</span> <span class="title">socket</span>. <span class="title">Please</span> <span class="title">authenticate</span> <span class="title">using</span> <span class="title">MongoClient</span>.<span class="title">connect</span> <span class="title">with</span> <span class="title">aut</span></span><br><span class="line">h credentials.</span><br><span class="line">Mongoose connect mongodb://bloger:bloger@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">27017</span>/blog success</span><br></pre></td></tr></table></figure>
<ul>
<li>打开浏览器，访问：<a>localhost:3000</a> 或者 <a>127.0.0.1：3000</a><br><img src="https://raw.githubusercontent.com/Klay-Clam/Klay-Clam.github.io/master/img/nodeajaxruntime.png" alt="dome"><a id="more"></a> </li>
<li>让我们输入内容<br><img src="https://raw.githubusercontent.com/Klay-Clam/Klay-Clam.github.io/master/img/nodeajaxruntime1.png" alt="input"></li>
<li>node后台就会看到请求已经成功而且数据库数据插入已经完成。<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据库</span></span><br><span class="line">&gt;mongo </span><br><span class="line">&gt;use <span class="keyword">blog</span></span><br><span class="line"><span class="keyword">&gt;db.auth("bloger","bloger")</span></span><br><span class="line"><span class="keyword">1</span></span><br><span class="line"><span class="keyword">&gt;show </span>collections</span><br><span class="line"><span class="keyword">blogs</span></span><br><span class="line"><span class="keyword">&gt;db.blogs.find()</span></span><br><span class="line"><span class="keyword">&#123; </span><span class="string">"_id"</span> : ObjectId(<span class="string">"5987221da7794315386922c9"</span>), <span class="string">"title"</span> : <span class="string">"first"</span>, <span class="string">"author"</span> : <span class="string">"Klay"</span>, <span class="string">"content"</span> : <span class="string">"success?"</span>, <span class="string">"date"</span> : ISODate(<span class="string">"2017-08-06T14:05:17.563Z"</span>) &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>至此,前端ajax与node后台的交互，全部完成。demo很粗糙，但是应该能说明问题。有时间再做打磨吧～<br>enjoy.</p>
</blockquote>
<blockquote>
<p><a href="https://github.com/Klay-Clam/NodeAjax" target="_blank" rel="noopener">demo[呆萌] 在这里</a></p>
</blockquote>
</p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a href="http://twitter.com/home?status=http://yoursite.com/2017/08/02/nodeExpressAjax/%20拖泥脑湿的博客%20Node接收和处理前端的Ajax请求" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2017/08/10/nodeedgecsharp/" title="通过edge.js调用C# 动态链接库 dll，我踩踩坑什么的"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: 通过edge.js调用C# 动态链接库 dll，我踩踩坑什么的</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2017/07/27/MongoDb-用户管理以及数据库远程连接设置/" title="MongoDB--用户管理以及数据库远程连接设置">下一篇: MongoDB--用户管理以及数据库远程连接设置&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2019&nbsp;<a target="_blank" href="http://yoursite.com" rel="noopener noreferrer">Klay-Clam</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>