<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Klay-Clam"><title>sinopia搭建内部npm后端和在客户端如何使用内部npm进行开发 · 拖泥脑湿的博客</title><meta name="description" content="sinopia搭建内部npm
服务器：CentOS 7原料：安装Node.js,npm

1. 使用npm安装yarn在CentOS使用nvm安装好指定版本的NodeJS之后，使用npm安装yarn模块。使用yarn进行node package的管理。（优势，速度比npm快，install成功率"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">Tony's Notebook</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">拖泥脑湿的手账</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/categories">分类</a></li><li><a href="/tags">标签</a></li><li class="soc"><a href="https://github.com/Klay-Clam" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="http://yoursite.com" rel="noopener noreferrer">Klay-Clam</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>sinopia搭建内部npm后端和在客户端如何使用内部npm进行开发</a></p><p class="post-meta"><span class="date meta-item">发布于&nbsp;2018-07-26</span><span class="meta-item"><i class="fa fa-folder"></i><span>&nbsp;</span><a href="/categories/node/" title="node" class="a-tag">node</a><span>&nbsp;</span></span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/npm/" title="npm" class="a-tag">npm</a><span>&nbsp;</span><a href="/tags/sinopia/" title="sinopia" class="a-tag">sinopia</a><span>&nbsp;</span></span></p><p class="post-abstract"><h2 id="sinopia搭建内部npm"><a href="#sinopia搭建内部npm" class="headerlink" title="sinopia搭建内部npm"></a><code>sinopia</code>搭建内部<code>npm</code></h2><blockquote>
<p>服务器：CentOS 7<br>原料：安装Node.js,npm</p>
</blockquote>
<h3 id="1-使用npm安装yarn"><a href="#1-使用npm安装yarn" class="headerlink" title="1. 使用npm安装yarn"></a>1. 使用<code>npm</code>安装<code>yarn</code></h3><p>在CentOS使用nvm安装好指定版本的NodeJS之后，使用npm安装yarn模块。使用yarn进行node package的管理。（优势，速度比npm快，install成功率更高）<br>使用如下命令：<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装yarn</span></span><br><span class="line">npm <span class="keyword">install</span> -g yarn</span><br></pre></td></tr></table></figure></p>
<h3 id="2-使用yarn安装和配置sinopia"><a href="#2-使用yarn安装和配置sinopia" class="headerlink" title="2. 使用yarn安装和配置sinopia"></a>2. 使用<code>yarn</code>安装和配置<code>sinopia</code></h3><p>全局安装yarn之后，使用yarn全局安装sinopia，运行sinopia。发现未找到sinopia命令。<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装sinopia</span></span><br><span class="line">yarn global <span class="keyword">add</span><span class="bash"> sinopia</span></span><br><span class="line"><span class="bash"><span class="comment"># 运行sinopia</span></span></span><br><span class="line"><span class="bash">sinopia</span></span><br><span class="line"><span class="bash"><span class="comment"># 未找到sinopia命令</span></span></span><br></pre></td></tr></table></figure></p>
<p>需要使用命令<code>yarn global bin</code>查看yarn下载的依赖安装的位置，加入系统的path中。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn global bin</span><br><span class="line"><span class="comment"># /home/unisolnpmadmin/.yarn/bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用下面的命令把yarn的path加入系统的path</span></span><br><span class="line">export PATH=<span class="variable">$PATH</span><span class="symbol">:/home/unisolnpmadmin/</span>.yarn/bin</span><br></pre></td></tr></table></figure>
<p>配置完成之后，使用sinopia命令启动sinopia服务<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sinopia</span><br><span class="line"><span class="meta">#</span><span class="bash"> warn  --- config file - /home/unisolnpmadmin/.config/sinopia/config.yaml</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> warn  --- http address - http://localhost:4873/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 打印出来的就是sinopia的配置文件地址和服务启动的端口信息</span></span><br></pre></td></tr></table></figure></p>
<p>接下来修改sinopia的配置文件，使得其他的客户端可以访问这个服务。<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This is the default config file. It allows all users to do anything,</span></span><br><span class="line"><span class="comment"># so don't use it on production systems.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Look here for more config file examples:</span></span><br><span class="line"><span class="comment"># https://github.com/rlidwka/sinopia/tree/master/conf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># path to a directory with all packages</span></span><br><span class="line"><span class="attr">storage:</span> <span class="string">./storage</span></span><br><span class="line"></span><br><span class="line"><span class="attr">auth:</span></span><br><span class="line"><span class="attr">  htpasswd:</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">./htpasswd</span></span><br><span class="line">    <span class="comment"># Maximum amount of users allowed to register, defaults to "+inf".</span></span><br><span class="line">    <span class="comment"># You can set this to -1 to disable registration.</span></span><br><span class="line">    <span class="comment">#max_users: 1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a list of other known repositories we can talk to</span></span><br><span class="line"><span class="attr">uplinks:</span></span><br><span class="line"><span class="attr">  npmjs:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">https://registry.npmjs.org/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">packages:</span></span><br><span class="line">  <span class="string">'@*/*'</span><span class="string">:</span></span><br><span class="line">    <span class="comment"># scoped packages</span></span><br><span class="line"><span class="attr">    access:</span> <span class="string">$all</span></span><br><span class="line"><span class="attr">    publish:</span> <span class="string">$authenticated</span></span><br><span class="line"></span><br><span class="line">  <span class="string">'*'</span><span class="string">:</span></span><br><span class="line">    <span class="comment"># allow all users (including non-authenticated users) to read and</span></span><br><span class="line">    <span class="comment"># publish all packages</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># you can specify usernames/groupnames (depending on your auth plugin)</span></span><br><span class="line">    <span class="comment"># and three keywords: "$all", "$anonymous", "$authenticated"</span></span><br><span class="line"><span class="attr">    access:</span> <span class="string">$all</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># allow all known users to publish packages</span></span><br><span class="line">    <span class="comment"># (anyone can register by default, remember?)</span></span><br><span class="line"><span class="attr">    publish:</span> <span class="string">$authenticated</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if package is not available locally, proxy requests to 'npmjs' registry</span></span><br><span class="line"><span class="attr">    proxy:</span> <span class="string">npmjs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># log settings</span></span><br><span class="line"><span class="attr">logs:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">&#123;type:</span> <span class="string">stdout,</span> <span class="attr">format:</span> <span class="string">pretty,</span> <span class="attr">level:</span> <span class="string">http&#125;</span></span><br><span class="line">  <span class="comment">#- &#123;type: file, path: sinopia.log, level: info&#125;</span></span><br><span class="line"><span class="comment"># 这里添加listen，其他的客户端也可以访问该服务。</span></span><br><span class="line"><span class="attr">listen:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4873</span></span><br></pre></td></tr></table></figure></p>
<p>以上的配置修改之后，重新一下sinopia，这时候发现其他的客户端还不能访问这个服务，还需要开放CentOS的防火墙和指定端口。</p>
<h3 id="3-开放CentOS的指定端口"><a href="#3-开放CentOS的指定端口" class="headerlink" title="3. 开放CentOS的指定端口"></a>3. 开放CentOS的指定端口</h3><blockquote>
<p>使用firewalld修改和配置CentOS的防火墙</p>
</blockquote>
<p>1.启动防火墙<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="literal">start</span> firewalld</span><br></pre></td></tr></table></figure></p>
<p>2.禁用防火墙<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">stop</span> firewalld</span><br></pre></td></tr></table></figure></p>
<p>3.设置开机启动<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="builtin-name">enable</span> firewalld</span><br></pre></td></tr></table></figure></p>
<p>4.停止并禁用开机启动<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sytemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p>
<p>5.重启防火墙<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --reload</span></span><br></pre></td></tr></table></figure></p>
<p>6.查看状态<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld或者 firewall-<span class="keyword">cmd</span><span class="bash"> --state</span></span><br></pre></td></tr></table></figure></p>
<p>7.查看版本<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --version</span></span><br></pre></td></tr></table></figure></p>
<p>8.查看帮助<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --<span class="built_in">help</span></span></span><br></pre></td></tr></table></figure></p>
<p>9.查看区域信息<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --get-active-zones</span></span><br></pre></td></tr></table></figure></p>
<p>10.查看指定接口所属区域信息<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --<span class="keyword">get</span>-zone-of-<span class="keyword">interface</span>=eth0</span><br></pre></td></tr></table></figure></p>
<p>11.拒绝所有包<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --panic-on</span></span><br></pre></td></tr></table></figure></p>
<p>12.取消拒绝状态<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --panic-off</span></span><br></pre></td></tr></table></figure></p>
<p>13.查看是否拒绝<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --query-panic</span></span><br></pre></td></tr></table></figure></p>
<p>14.将接口添加到区域(默认接口都在public)<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=<span class="keyword">public</span> --<span class="keyword">add</span>-<span class="keyword">interface</span>=eth0(永久生效再加上 --permanent 然后reload防火墙)</span><br></pre></td></tr></table></figure></p>
<p>15.设置默认接口区域<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --<span class="keyword">set</span>-<span class="keyword">default</span>-zone=<span class="keyword">public</span>(立即生效，无需重启)</span><br></pre></td></tr></table></figure></p>
<p>16.更新防火墙规则<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --reload或firewall-cmd --complete-reload(两者的区别就是第一个无需断开连接，就是firewalld特性之一动态</span></span><br><span class="line"><span class="bash">添加规则，第二个需要断开连接，类似重启服务)</span></span><br></pre></td></tr></table></figure></p>
<p>17.查看指定区域所有打开的端口<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=<span class="keyword">public</span> --<span class="built_in">list</span>-ports</span><br></pre></td></tr></table></figure></p>
<p>18.在指定区域打开端口（记得重启防火墙）<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd <span class="attribute">--zone</span>=public <span class="attribute">--add-port</span>=80/tcp(永久生效再加上 --permanent)</span><br></pre></td></tr></table></figure></p>
<p>我们只需要开放端口4873就可以，然后重启防火墙。</p>
<p>现在我们在客户端访问 <code>http://serverip:4873</code>的时候，就会看到，sinopia已经可以访问了。</p>
<h3 id="4-使用pm2保护内部sinopia的进程"><a href="#4-使用pm2保护内部sinopia的进程" class="headerlink" title="4. 使用pm2保护内部sinopia的进程"></a>4. 使用<code>pm2</code>保护内部<code>sinopia</code>的进程</h3><p>node的进程很脆弱，所以我们使用pm2保护sinopia的进程。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装pm2</span></span><br><span class="line">yarn global <span class="keyword">add</span><span class="bash"> pm2</span></span><br><span class="line"><span class="bash"><span class="comment"># 使用pm2启动sinopia</span></span></span><br><span class="line"><span class="bash">pm2 start `<span class="built_in">which</span> sinopia`</span></span><br></pre></td></tr></table></figure>
<p>关于pm2，有好多好用的东西，查看服务的日志，查看服务的状态等。有待挖掘。</p>
<p>至此，sinopia的服务端的配置稍微告一段落，更多个性化的配置，可以在后面添加。接下来介绍一下开发者如何在自己的客户端上使用刚才搭建的sinopia的服务。</p>
<h2 id="客户端如何使用内部npm进行开发"><a href="#客户端如何使用内部npm进行开发" class="headerlink" title="客户端如何使用内部npm进行开发"></a>客户端如何使用内部npm进行开发</h2><blockquote>
<p>关键字：<code>npm、yarn、nvm、nrm</code></p>
</blockquote>
<h3 id="1-使用npm下载yarn"><a href="#1-使用npm下载yarn" class="headerlink" title="1. 使用npm下载yarn"></a>1. 使用<code>npm</code>下载<code>yarn</code></h3><p>鉴于很多时候，yarn的package的管理效率高于npm，所以我们使用安装yarn下载我们需要的一些包。<br>下载方式前面已经介绍过了，不赘述。</p>
<h3 id="2-使用yarn下载nrm"><a href="#2-使用yarn下载nrm" class="headerlink" title="2. 使用yarn下载nrm"></a>2. 使用<code>yarn</code>下载<code>nrm</code></h3><p>mrn是管理npm下载node package的源的工具，使用nrm可以优雅的控制使用哪一个源来进行<code>npm install xxx</code>.<br>我们选择使用yarn全局安装<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">yarn</span> <span class="meta">global</span> <span class="keyword">add </span>nrm</span><br></pre></td></tr></table></figure></p>
<p>安装完成之后，先来看看当前客户端有哪些npm install的源。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">nrm</span> <span class="string">ls</span></span><br><span class="line"><span class="string">*</span> <span class="string">npm</span> <span class="bullet">----</span> <span class="attr">https://registry.npmjs.org/</span></span><br><span class="line">  <span class="string">cnpm</span> <span class="meta">---</span> <span class="attr">http://r.cnpmjs.org/</span></span><br><span class="line">  <span class="string">taobao</span> <span class="bullet">-</span> <span class="attr">https://registry.npm.taobao.org/</span></span><br><span class="line">  <span class="string">nj</span> <span class="bullet">-----</span> <span class="attr">https://registry.nodejitsu.com/</span></span><br><span class="line">  <span class="string">rednpm</span> <span class="bullet">-</span> <span class="attr">http://registry.mirror.cqupt.edu.cn/</span></span><br><span class="line">  <span class="string">npmMirror</span>  <span class="attr">https://skimdb.npmjs.com/registry/</span></span><br><span class="line">  <span class="string">edunpm</span> <span class="bullet">-</span> <span class="attr">http://registry.enpmjs.org/</span></span><br></pre></td></tr></table></figure>
<h3 id="3-配置客户端的npm-registry"><a href="#3-配置客户端的npm-registry" class="headerlink" title="3. 配置客户端的npm --registry"></a>3. 配置客户端的<code>npm --registry</code></h3><p>接下来使用nrm把我们的sinopia源添加进去。<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nrm <span class="keyword">add</span><span class="bash"> unisolnpm http://192.168.90.185:4873</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">    add registry unisolnpm success</span></span><br></pre></td></tr></table></figure></p>
<p>再次运行<code>nrm ls</code><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">*</span> <span class="string">npm</span> <span class="bullet">----</span> <span class="attr">https://registry.npmjs.org/</span></span><br><span class="line">  <span class="string">cnpm</span> <span class="meta">---</span> <span class="attr">http://r.cnpmjs.org/</span></span><br><span class="line">  <span class="string">taobao</span> <span class="bullet">-</span> <span class="attr">https://registry.npm.taobao.org/</span></span><br><span class="line">  <span class="string">nj</span> <span class="bullet">-----</span> <span class="attr">https://registry.nodejitsu.com/</span></span><br><span class="line">  <span class="string">rednpm</span> <span class="bullet">-</span> <span class="attr">http://registry.mirror.cqupt.edu.cn/</span></span><br><span class="line">  <span class="string">npmMirror</span>  <span class="attr">https://skimdb.npmjs.com/registry/</span></span><br><span class="line">  <span class="string">edunpm</span> <span class="bullet">-</span> <span class="attr">http://registry.enpmjs.org/</span></span><br><span class="line">  <span class="string">unisolnpm</span> <span class="bullet">-</span>  <span class="attr">http://192.168.90.185:4873/</span></span><br></pre></td></tr></table></figure></p>
<p>然后我们使用nrm切换到内部的npm源中</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm <span class="keyword">use</span> unisolnpm</span><br></pre></td></tr></table></figure>
<h3 id="4-客户端创建用户和登录"><a href="#4-客户端创建用户和登录" class="headerlink" title="4. 客户端创建用户和登录"></a>4. 客户端创建用户和登录</h3><p>接下来我们就可以使用npm在内部npm 服务上创建用户了。</p>
<p>使用命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm adduser </span><br><span class="line"><span class="meta">#</span><span class="bash"> 接下来根据指示操作就可以完成注册用户。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 npm login进行登录操作</span></span><br><span class="line">npm login</span><br><span class="line"><span class="meta">#</span><span class="bash"> 根据指示填写信息，就可以完成登录。</span></span><br></pre></td></tr></table></figure></p>
<h3 id="5-install-package和publish-package"><a href="#5-install-package和publish-package" class="headerlink" title="5. install package和publish package"></a>5. <code>install package</code>和<code>publish package</code></h3><p>登录npm之后，我们就可以使用我们内部的npm源进行node package的安装和发布了。</p>
<h4 id="install-package"><a href="#install-package" class="headerlink" title="install package"></a><code>install package</code></h4><p>当我们使用<code>npm install xxx</code>安装<code>xxx</code>时，假设在内部的<code>storage</code>存在该模块，就会直接下载该模块，假设不存在，就会使用在<code>sinopia</code>配置文件中配置的源进行拉取安装，并在<code>sinopia</code>的<code>storage</code>中进行缓存，方便下次安装。</p>
<h4 id="publish-package"><a href="#publish-package" class="headerlink" title="publish package"></a><code>publish package</code></h4><p></p>
<ol>
<li>使用<code>npm init</code>初始化</li>
<li>进入该项目目录，然后使用<code>npm publish</code>进行发布<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> publish</span><br><span class="line"><span class="comment"># 打印出发布的包名和版本信息，表示发布成功。</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>发布的时候要注意包名称和版本号冲突的问题，稍作修改就搞了。</p>
<p>后面还需要进行更多的研究。</p>
<p>以上，搭建内部的npm源服务就结束了，enjoy～</p>
</p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a href="http://twitter.com/home?status=http://yoursite.com/2018/07/26/sinopia搭建内部npm服务/%20拖泥脑湿的博客%20sinopia搭建内部npm后端和在客户端如何使用内部npm进行开发" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2019/06/13/let和const/" title="ES6-let/const"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: ES6-let/const</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2018/07/16/codewars-first/" title="CodeWars 使用记录（一）">下一篇: CodeWars 使用记录（一）&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="http://yoursite.com" rel="noopener noreferrer">Klay-Clam</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>